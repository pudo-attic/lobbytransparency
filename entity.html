---
layout: default
title: Loading...
---

<div id='entity'></div>

{% raw %}
<script id="actor" type="text/x-handlebars-template">
    <h2 class="page-header">{{title}} 
        <small>
            {{#actsAsPerson}}<span class='label'>Person</span>{{/actsAsPerson}}
            {{#actsAsRepresentative}}<span class='label'>Registrant</span>{{/actsAsRepresentative}}
            {{#actsAsClient}}<span class='label'>Client</span>{{/actsAsClient}}
            {{#actsAsOrganisation}}<span class='label'>Org Member</span>{{/actsAsOrganisation}}
        </small>
    </h2>
    

    <div class='row'>
        <div class='span4'>
            <dl>
                {{#acronym}}
                    <dt>Acronym</dt>
                    <dd>{{this}}</dd>
                {{/acronym}}
                {{#subCategory}}
                    <dt>Category</dt>
                    <dd>{{this}}</dd>
                {{/subCategory}}
                {{#legalStatus}}
                    <dt>Legal Status</dt>
                    <dd>{{this}}</dd>
                {{/legalStatus}}
                {{#head}}
                    <dt>Head Representative</dt>
                    <dd>
                        <a href='{{this.url}}'>{{this.title}}</a>
                        <p class='help-block'>{{this.position}}</p>
                    </dd>
                {{/head}}
                {{#legal}}
                    <dt>Legal Representative</dt>
                    <dd>
                        <a href='{{this.url}}'>{{this.title}}</a>
                        <p class='help-block'>{{this.position}}</p>
                    </dd>
                {{/legal}}
                <!-- TODO: legal & head person. -->
                {{#members}}
                    <dt>Members/Representatives</dt>
                    <dd>{{this}}</dd>
                {{/members}}
                {{#webSiteURL}}
                    <dt>Web site</dt>
                    <dd><a href="{{this}}">{{this}}</a></dd>
                {{/webSiteURL}}
                {{#contactPhone}}
                    <dt>Phone</dt>
                    <dd>(+{{../contactIndicPhone}}) {{this}}</a></dd>
                {{/contactPhone}}
                {{#contactCountry}}
                    <dt>Address</dt>
                    <dd><address>
                        {{../contactStreet}} {{../contactNumber}}<br/>
                        {{../contactPostCode}} {{../contactTown}}<br/>
                        {{this}}
                        {{#../contactMore}}
                            <p class='help-block'>{{preformatted this}}</p>
                        {{/../contactMore}}
                    </address></dd>
                {{/contactCountry}}
                {{#if interests}}
                    <dt>Interests</dt>
                    <dd><ul class="unstyled">
                        {{#interests}}
                            <li>{{this}}</li>
                        {{/interests}}
                    </ul></dd>
                {{/if}}
                
            </dl>
        </div>
        <div class='span8'>
            {{#activities}}
                <p>{{preformatted this}}</p>
            {{/activities}}

            {{#if fdType}}
            <h3>Financial Statement
                <small>Period of {{dateformat fdStartDate}} -
                   {{dateformat fdEndDate}}</small>
            </h3>
            <table class="table table-striped table-condensed">
                <tr>
                    <th colspan="2">Expenditure</th>
                    <th width="30%"></th>
                </tr>
                <tr>
                    <td colspan="2">Cost</td>
                    <td>{{fdCost}}</td>
                </tr>
                <tr>
                    <td colspan="2">Direct Representation Cost</td>
                    <td>{{fdDirectRepCosts}}</td>
                </tr>
                <tr>
                    <th colspan="2">Revenue</th>
                    <th></th>
                </tr>
                <tr>
                    <td colspan="2">Client Turnover</td>
                    <td>{{fdTurnover}}</td>
                </tr>
                <tr>
                    <td colspan="2">European Sources</td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td>Grants</td>
                    <td>{{amount fdEurSourcesGrants}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Procurement</td>
                    <td>{{amount fdEurSourcesProcurement}}</td>
                </tr>
                <tr>
                    <td colspan="2">Publicly Financed</td>
                    <td>{{amount fdPublicFinancingTotal}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>National</td>
                    <td>{{amount fdPublicFinancingNational}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Infranational</td>
                    <td>{{amount fdPublicFinancingInfranational}}</td>
                </tr>
                <!-- TODO: Other -->
                <tr>
                    <td colspan="2">Other Sources</td>
                    <td>{{amount fdOtherSourcesTotal}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Donations</td>
                    <td>{{amount fdOtherSourcesDonation}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Contributions</td>
                    <td>{{amount fdOtherSourcesContributions}}</td>
                </tr>
                <!-- TODO: Other -->
                <tr>
                    <td colspan="2">Total Budget</td>
                    <td>{{amount fdTotalBudget}}</td>
                </tr>
            </table>
            {{/if}}

            {{#if employers}}
            <h3>Employers</h3>
            <table class="table table-striped table-condensed">
                {{#employers}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                    </tr>
                {{/employers}}
            </table>
            {{/if}}

            {{#if memberships}}
            <h3>Memberships</h3>
            <table class="table table-striped table-condensed">
                {{#memberships}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                    </tr>
                {{/memberships}}
            </table>
            {{/if}}

            {{#if memberorgs}}
            <h3>Member Organisations</h3>
            <table class="table table-striped table-condensed">
                {{#memberorgs}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                    </tr>
                {{/memberorgs}}
            </table>
            {{/if}}

            {{#if accreditations}}
            <h3>European Parliament Accreditations</h3>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>Name</th>
                    <th width="20%">Accreditation End</th>
                </tr>
                {{#accreditations}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                        <td width="20%">{{dateformat accreditationEndDate}}</td>
                    </tr>
                {{/accreditations}}
            </table>
            {{/if}}

            {{#if firms}}
            <h3>Hired Representatives</h3>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>Firm</th>
                    <th width="30%">Expenditure</th>
                </tr>
                {{#firms}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                        <td>{{exp}}</td>
                    </tr>
                {{/firms}}
            </table>
            {{/if}}

            {{#if clients}}
            <h3>Clients</h3>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>Client</th>
                    <th width="30%">Expenditure</th>
                </tr>
                {{#clients}}
                    <tr>
                        <td><a href="{{url}}">{{title}}</a></td>
                        <td>{{exp}}</td>
                    </tr>
                {{/clients}}
            </table>
            {{/if}}

            {{#goals}}
                <h3>Goals</h3>
                <p>{{preformatted this}}</p>
            {{/goals}}
            {{#networking}}
                <h3>Networking</h3>
                <p>{{preformatted this}}</p>
            {{/networking}}
        </div>
    </div>
</script>
{% endraw %}






<script>
    $(function() {
        var templates = {
            actor: Handlebars.compile($('#actor').html())
            };
        hashChange = function() {
            var query = document.location.hash.substring(1);
            if(!query.length) {
                alert("No ID specified!");
            }
            var params = LobbyTransparency.parseQuery(query);
            $.get(LobbyTransparency.apiUrl + 'eutr/entities/' + params.id + '/deep', function(data) {
                $('title').html(data.title);
                data.raw = JSON.stringify(data, null, '  ');

                data.interests = _.map(_.filter(data.outgoing, 
                    function(e) { return e.target.type=='interest'; }),
                    function(e) { return e.target.title; }).sort();

                data.head = _.first(_.map(_.filter(data.outgoing, 
                    function(e) { return e.type=='employment' && e.role=='head'; }),
                    function(e) { 
                        e.target.url = LobbyTransparency.entityUrl(e.target.id); 
                        e.target.position = e.position;
                        return e.target; 
                    }));
                data.legal = _.first(_.map(_.filter(data.outgoing, 
                    function(e) { return e.type=='employment' && e.role=='legal'; }),
                    function(e) { 
                        e.target.url = LobbyTransparency.entityUrl(e.target.id);
                        e.target.position = e.position;
                        return e.target; 
                    }));

                data.accreditations = _.map(_.filter(data.outgoing, 
                    function(e) { return e.type=='employment' && e.role=='accredited'; }),
                    function(e) { 
                        e.target.url = LobbyTransparency.entityUrl(e.target.id);
                        e.target.position = e.position;
                        return e.target; 
                    });

                data.employers = _.uniq(_.map(_.filter(data.incoming, 
                    function(e) { return e.type=='employment'; }),
                    function(e) { 
                        e.source.url = LobbyTransparency.entityUrl(e.source.id);
                        return e.source; 
                    }));

                data.firms = _.map(_.filter(data.outgoing, 
                    function(e) { return e.type=='turnover'; }),
                    function(e) { 
                        e.target.url = LobbyTransparency.entityUrl(e.target.id);
                        e.target.exp = LobbyTransparency.numRange(e.min, e.max);
                        return e.target; 
                    });

                data.clients = _.map(_.filter(data.incoming, 
                    function(e) { return e.type=='turnover'; }),
                    function(e) { 
                        e.source.url = LobbyTransparency.entityUrl(e.source.id);
                        e.source.exp = LobbyTransparency.numRange(e.min, e.max);
                        return e.source; 
                    });

                data.memberorgs = _.map(_.filter(data.outgoing, 
                    function(e) { return e.type=='member'; }),
                    function(e) { 
                        e.target.url = LobbyTransparency.entityUrl(e.target.id);
                        return e.target; 
                    });

                data.memberships = _.map(_.filter(data.incoming, 
                    function(e) { return e.type=='member'; }),
                    function(e) { 
                        e.source.url = LobbyTransparency.entityUrl(e.source.id);
                        return e.source; 
                    });

                data.fdCost = LobbyTransparency.numRange(data.fdCostMin, data.fdCostMax, data.fdCostAbsolute);
                data.fdDirectRepCosts = LobbyTransparency.numRange(data.fdDirectRepCostsMin, data.fdDirectRepCostsMax);
                data.fdTurnover= LobbyTransparency.numRange(data.fdTurnoverMin, data.fdTurnoverMax, 
                    data.fdTurnoverAbsolute);

                console.log(data);
                $('#entity').html(templates[data.type](data));
                
            }, 'jsonp');
        };

        $(window).bind( 'hashchange', function(e) { hashChange(); });
        hashChange();
    });
</script>